{% extends "base.html" %} 
{% block registerClass %}active{% endblock %}
{% block content %}
<div class="breadcrumb-wrap breadcrumb-light" style="background-color:#000;">
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <h4>Get Listed as a Doctor</h4>
            </div>
            <div class="col-sm-6 hidden-xs text-right">
                <ol class="breadcrumb">
                    <li><a href="/">Doctor</a></li>
                    <li>Registration</li>
                </ol>
            </div>
        </div>
    </div>
</div><!--breadcrumb light-->
<div class="divide60"></div>
<div class="container">
	<div class="row">
        <div class="col-sm-12 sky-form-login-register v2">
            <div class="margin40">

                <form action="" method="POST" role="form" id="sky-form-doctors" class="sky-form">{% csrf_token %}
                    <h3 class="text-center">Create new account with DoctorsInfo</h3>

                    <fieldset>
                    	<div class="row">
	                        <section class="col col-4">
	                        	<label>Name</label>
	                            <label class="input">
	                                <i class="icon-append fa fa-user"></i>
	                                {{form.practitioner_name}}
	                                <b class="tooltip tooltip-bottom-right">Needed to enter the website</b>
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Gender</label>
	                            <label class="select">
	                                {{form.practitioner_gender}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Year of Birth</label>
	                            <label class="select">
	                                {{form.year_of_birth}}
	                                <i></i>
	                            </label>
	                        </section>
	                    </div>
	                    <div class="row">
	                        <section class="col col-4">
	                        	<label>Email Address</label>
	                            <label class="input">
	                                <i class="icon-append fa fa-envelope-o"></i>
	                                {{form.email}}
	                                <b class="tooltip tooltip-bottom-right">Needed to verify your account</b>
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Physician Type</label>
	                            <label class="select">
	                                {{form.physician_type}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                            <div class="form-group">
									<label>{{form.credentials.label_tag}}</label>
									{{form.credentials}}
									<span class="help-block with-errors"></span>
								</div>
	                        </section>
	                    </div>
	                    <div class="row">
	                    	<section class="col col-4">
	                        	<label>Speciality</label>
	                            <label class="select">
	                                {{form.specialities}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-2">
	                        	<label>Conditions Treated</label>
	                            <label class="select">
	                                <select id="id_conditions_custom" multiple="multiple" name="conditions_custom"></select>
	                                {{form.conditions}}
	                            </label>
	                        </section>
	                        <section class="col col-2">
	                        	<label>Procedures Peformed</label>
	                            <label class="select">
	                                <select id="id_procedures_custom" multiple="multiple" name="procedures_custom"></select>
	                                {{form.procedures}}
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Experience (in Years)</label>
	                            <label class="input">
	                                {{form.experience}}
	                                <b class="tooltip tooltip-bottom-right">Experience in Years</b>
	                            </label>
	                        </section>
	                    </div>
	                    <div class="row">
	                    	<section class="col col-6">
	                    		<label>Message for Patients</label>
	                            <label class="input">
	                                {{form.message}}
	                                <b class="tooltip tooltip-bottom-right">Current Status</b>
	                            </label>
	                        </section>
	                        <section class="col col-6">
	                        	<label>Achievements</label>
	                            <label class="textarea">
	                                {{form.achievements}}
	                                <b class="tooltip tooltip-bottom-right">Specify Your Achievements</b>
	                            </label>
	                        </section>
	                    </div>
                    </fieldset>

                    <fieldset>
                        <div class="row">
                            <section class="col col-4">
                            	<label>Type</label>
                                <label class="select">
                                    {{form.practice_type}}
                                    <i></i>
                                </label>
                            </section>
                            <section class="col col-4">
                            	<label>Name</label>
                                <label class="input">
                                    {{form.practice_name}}
                                </label>
                            </section>
                            <section class="col col-4">
                        		<label>Address</label>
                                <label class="textarea">
                                    {{form.address}}
                                </label>
                            </section>
                        </div>
                        <div class="row">
                            <section class="col col-4">
                            	<label>City</label>
                                <label class="select">
                                    {{form.city}}
                                    <i></i>
                                </label>
                            </section>
                            <section class="col col-4">
                            	<label>Area</label>
                                <label class="select">
                                	<select id="id_area_custom" name="area_custom">
                                		<option value='' selected disabled>Please Select an Area</option>
                                	</select>
                                    {{form.area}}
                                    <i></i>
                                </label>
                            </section>
                            <section class="col col-4">
                            	<label style="height:20px;"></label>
                            	<label class="select">
	                            	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#mapModal">Show on Map</button>
	                            </label>
                    			{{form.lat}}{{form.lon}}
                    		</section>
                        </div>
                        <div class="row">
	                        <section class="col col-4">
	                        	<label>Contact Number</label>
	                            <label class="input">
	                                <i class="icon-append fa fa-envelope-o"></i>
	                                {{form.contact_number}}
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Appointment</label>
	                            <label class="select">
	                                {{form.appointment}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-4">
	                        	<label>Checkup Fee</label>
	                            <label class="select">
	                                {{form.checkup_fee}}
	                                <i></i>
	                            </label>
	                        </section>
	                    </div>
	                    <footer style="padding-right:0;">
	                    	<button type="button" class="button" id="add_location">Add Another Location</button>
	                    </footer>
	                </fieldset>

	                <fieldset>
	                    <div class="row">
	                    	<section class="col col-3">
	                    		<label>Day From</label>
	                            <label class="select">
	                                {{form.day_from}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-3">
	                        	<label>Day To</label>
	                            <label class="select">
	                                {{form.day_to}}
	                                <i></i>
	                            </label>
	                        </section>
	                        <section class="col col-3">
	                        	<label>Starting Time</label>
	                            <label class="input">
	                                {{form.start_time}}
	                            </label>
	                        </section>
	                        <section class="col col-3">
	                        	<label>Ending Time</label>
	                            <label class="input">
	                                {{form.end_time}}
	                            </label>
	                        </section>
	                    </div>
	                    <footer style="padding-right:0;">
	                    	<button type="button" class="button" id="add_timing">Add Another Timing</button>
	                    </footer>
	                </fieldset>

                    <fieldset>
                    	<footer>
                    		<div class="row recaptcha-parent">

                    			<input type="hidden" class="hiddenRecaptcha required" name="hiddenRecaptcha" id="hiddenRecaptcha">
                    			<div class="g-recaptcha" data-sitekey="6LcAdv4SAAAAAI2hi_VgcifchYmJFUNmxdfajJJO"></div>
                    		</div>
                    		<div class="clear"></div>
                    		<div class="row">
                        		<button type="submit" class="button">Create account</button>
                        	</div>
                    	</footer>
                    </fieldset>
                </form>			
            </div><!--login form wrap end-->

        </div>
    </div>
</div>
<div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="mapModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Drag the marker to appropriate location and close map.</h4>
			</div>
			<div class="modal-body">
				<div style="width: 560px; height: 500px;" id="myMap"></div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% load staticfiles %}
{% block pageSpecificCSS %}
<link rel="stylesheet" href="{% static 'assets/css/bootstrap-tagsinput.css' %}">
<link href="{% static 'assets/css/sky-forms.css' %}" rel="stylesheet">
<link href="{% static 'assets/css/bootstrap-multiselect.css' %}" rel="stylesheet">
{% endblock %}

{% block pageSpecificJS %}
<script type="text/javascript" src="{% static 'assets/js/autosize.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/bootstrap-tagsinput.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/bootstrap3-typeahead.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/bootstrap-multiselect.js' %}"></script>
<script src="https://www.google.com/recaptcha/api.js"></script>
<script type="text/javascript" src="{% static 'assets/js/jquery.form.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/jquery.validate.min.js' %}"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
{% endblock %}


{% block customScript %}
<script type="text/javascript">

	var map;
	var marker;
	var myLatlng = new google.maps.LatLng(31.519191, 74.326237);
	var geocoder = new google.maps.Geocoder();
	var infowindow = new google.maps.InfoWindow();

	function initialize() {
	    var mapOptions = {
	        zoom: 12,
	        center: myLatlng,
	        mapTypeId: google.maps.MapTypeId.ROADMAP
	    };
	    map = new google.maps.Map(document.getElementById("myMap"), mapOptions);
	    marker = new google.maps.Marker({
	        map: map,
	        position: myLatlng,
	        draggable: true
	    });

	    geocoder.geocode({
	        'latLng': myLatlng
	    }, function(results, status) {
	        if (status == google.maps.GeocoderStatus.OK) {
	            if (results[0]) {
	                $('#id_lon').val(marker.getPosition().lat());
	                $('#id_lat').val(marker.getPosition().lng());
	                infowindow.setContent(results[0].formatted_address);
	                infowindow.open(map, marker);
	            }
	        }
	    });
	    google.maps.event.addListener(marker, 'dragend', function() {
	        geocoder.geocode({
	            'latLng': marker.getPosition()
	        }, function(results, status) {
	            if (status == google.maps.GeocoderStatus.OK) {
	                if (results[0]) {
	                    $('#id_lon').val(marker.getPosition().lat());
	                    $('#id_lat').val(marker.getPosition().lng());
	                    //console.log($('#id_lon').val()+" , "+$('#id_lat').val());
	                    infowindow.setContent(results[0].formatted_address);
	                    infowindow.open(map, marker);
	                }
	            }
	        });
	    });
	}
	google.maps.event.addDomListener(window, 'load', initialize);
	
	var data_source = Array();
	{% for p in degree_list %}
	data_source.push("{{p}}");
	{% endfor %}

	var location_count = 1;
	var timing_count = 1;

	$(document).ready(function(){

		autosize($('textarea'));

		$('#id_conditions_custom,#id_procedures_custom').html("");

		{% for c in conditions %}
		$("#id_conditions_custom").append("<option value='{{c.id}}'>{{c}}</option>");
		{% endfor %}

		{% for p in procedures %}
		$("#id_procedures_custom").append("<option value='{{p.id}}'>{{p}}</option>");
		{% endfor %}

		{% for a in areas %}
		$("#id_area_custom").append("<option value='{{a.id}}'>{{a}}</option>");
		{% endfor %}

		$('#id_conditions_custom,#id_procedures_custom').multiselect({numberDisplayed: 0});

		$('#id_credentials').tagsinput({
			typeahead: {
				source: data_source
			},
			freeInput: false
		});

		$("#id_city").on('change',function(){
			$.ajax({
				type: "GET",
				url: "{% url 'practice_areas' %}",
				data: {'city':$("#id_city").val()},
				success: function(data){
					$('#id_area_custom').html("<option value='' selected disabled>Please Select an Area</option>");
					for(i=0;i<data['areas'].length;i++){
						$("#id_area_custom").append(data['areas'][i]);
					}
				}
			});
		});

		$("#id_area_custom").on("change",function(){
			$("#id_area").val($("#id_area_custom").val());
		});

		$("#id_specialities").on('change',function(){
			$.ajax({
				type : 'GET',
				url : "{% url 'get_condition_procedure' %}",
				data: {'value':$("#id_specialities").val()},
				success : function (data) {
					$('#id_procedures_custom,#id_conditions_custom').html("");
					for(i=data['conditions'].length-1;i>=0;i--){
						$("#id_conditions_custom").append(data['conditions'][i]);
					}
					for(i=data['procedures'].length-1;i>=0;i--){
						$("#id_procedures_custom").append(data['procedures'][i]);
					}
					$('#id_procedures_custom,#id_conditions_custom').multiselect('rebuild');
				}
			});
		});

		$("body").on("click","#add_timing",function(){
			var fieldset_tag = $(this).parent();
			fieldset_tag.before('<fieldset><div class="row"><a href="#" class="close pull-right close-timing-extra-btn" style="color:#000;">&times;</a></div><div class="row"><section class="col col-3"><label class="select">{% spaceless %}{{form.day_from}}{% endspaceless %}</label></section><section class="col col-3"><label class="select">{% spaceless %}{{form.day_to}}{% endspaceless %}<i></i></label></section><section class="col col-3"><label class="input">{% spaceless %}{{form.start_time}}{% endspaceless %}</label></section><section class="col col-3"><label class="input">{% spaceless %}{{form.end_time}}{% endspaceless %}</label></section></div></fieldset>');
			var rec_added = fieldset_tag.prev();
			$(rec_added).find("#id_day_from").attr("name","customtiming_day_from_"+timing_count);
			$(rec_added).find("#id_day_to").attr("name","customtiming_day_to_"+timing_count);
			$(rec_added).find("#id_start_time").attr("name","customtiming_start_time_"+timing_count);
			$(rec_added).find("#id_end_time").attr("name","customtiming_end_time_"+timing_count);
			timing_count++;
		});

		$("body").on("click","#add_location",function(){
			var fieldset_tag = $(this).parent();
			fieldset_tag.before('<fieldset><div class="row"><a href="#" class="close pull-right close-loc-extra-btn" style="color:#000;">&times;</a></div><div class="row"><section class="col col-6"><label class="select">{% spaceless %}{{form.practice_type}}{% endspaceless %}<i></i></label></section><section class="col col-6"><label class="input">{% spaceless %}{{form.practice_name}}{% endspaceless %}</label></section></div><div class="row"><section class="col col-6"><label class="textarea">{% spaceless %}{{form.address}}{% endspaceless %}</label></section><section class="col col-6"><label class="select">{% spaceless %}{{form.city}}{% endspaceless %}<i></i></label></section></div><div class="row"><section class="col col-4"><label class="input"><i class="icon-append fa fa-envelope-o"></i>{% spaceless %}{{form.contact_number}}{% endspaceless %}</label></section><section class="col col-4"><label class="select">{% spaceless %}{{form.appointment}}{% endspaceless %}<i></i></label></section><section class="col col-4"><label class="input">{% spaceless %}{{form.checkup_fee}}{% endspaceless %}</label></section></div></fieldset>');
			var rec_added = fieldset_tag.prev();
			$(rec_added).find("#id_practice_type").attr("name","customloc_practice_type_"+location_count);
			$(rec_added).find("#id_practice_name").attr("name","customloc_practice_name_"+location_count);
			$(rec_added).find("#id_address").attr("name","customloc_address_"+location_count);
			$(rec_added).find("#id_city").attr("name","customloc_city_"+location_count);
			$(rec_added).find("#id_contact_number").attr("name","customloc_contact_number_"+location_count);
			$(rec_added).find("#id_appointment").attr("name","customloc_appointment_"+location_count);
			$(rec_added).find("#id_checkup_fee").attr("name","customloc_checkup_fee_"+location_count);
			location_count++;
		});

		$("body").on("click",".close-timing-extra-btn",function(){
			$(this).parent().parent().remove();
			timing_count--;
			return false;
		});

		$("body").on("click",".close-loc-extra-btn",function(){
			$(this).parent().parent().remove();
			location_count--;
			return false;
		});

		$("#sky-form-doctors").validate({
            // Rules for form validation
            ignore: ".ignore",
            rules:
                    {
                        practitioner_name:{required: true},
                        practitioner_gender:{required: true},
                        year_of_birth:{required: true},
                        email:{required: true,email: true},
                        physician_type:{required: true},
                        credentials:{required: true},
                        specialities:{required: true},
                        conditions:{
                        	required: function(){
                        		if($("#id_conditions_custom").val() != null){
                        			$("#id_conditions").val($("#id_conditions_custom").val().toString());
                        			return false;
                        		}else{
                        			return true;
                        		}
                        	}
                    	},
                        procedures:{
                        	required: function(){
                        		if($("#id_procedures_custom").val() != null){
                        			$("#id_procedures").val($("#id_procedures_custom").val().toString());
                        			return false;
                        		}else{
                        			return true;
                        		}
                        	}
                        },
                        experience:{required: true},
                        practice_type:{required: true},
                        practice_name:{required: true},
                        address:{required: true},
                        area:{
                        	required: function(){
                        		if($("#id_area_custom").val()){
                        			$("#id_area").val($("#id_area_custom").val());
                        			return false;
                        		}else{
                        			return true;
                        		}
                        	}
                        },
                        contact_number:{required: true},
                        appointment:{required: true},
                        day_from:{required: true},
                        day_to:{required: true},
                        start_time:{required: true},
                        end_time:{required: true},
                        hiddenRecaptcha: {
						    required: function() {
						        if(grecaptcha.getResponse() == '') {
						            return true;
						        } else {
						            return false;
						        }
						    }
						}
                    },
            // Messages for form validation
            messages:{
                        practitioner_name:{required: 'Please enter your Full Name'},
                        email:{required: 'Please enter your email address',email: 'Please enter a VALID email address'},
                        credentials:{required: 'Please mention your credentials'},
                        conditions:{required: 'Select atleast one'},
                        procedures:{required: 'Select atleast one'},
                        practice_name:{required: 'Please enter location name'},
                        address:{required: 'Please enter full address of location'},
                        area:{required: 'Please select an area'},
                        contact_number:{required: 'Please enter a valid contact number'},
                        start_time:{required: 'Please mention the opening time'},
                        end_time:{required: 'Please mention the closing time'},
                        hiddenRecaptcha:{required: 'Recaptcha verification required'}
                    },
            // Do not change code below
            errorPlacement: function(error, element)
            {
                error.insertAfter(element.parent());
            }
        });

	});
</script>
{% endblock %}