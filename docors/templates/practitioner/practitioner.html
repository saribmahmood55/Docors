<!DOCTYPE html>
<html>

<head>
  {% load staticfiles %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="{% static "icons/stethoscope.ico" %}" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.css" />
  <script src="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static "style/style.css" %}"rel="stylesheet" type="text/css" />
</head>

<body>
  <div data-role="page" data-title="{{data.practitioner.name}} | doctorsinfo.pk">
    <div data-role="header">
      <h1><a href="/" class="anchor-link" ><i class="fa fa-stethoscope fa-1x marg-r"></i>doctorsinfo.pk</a></h1>
      <div id="head">
        {% if data.user.is_authenticated %}
        <a href="{% url 'patient' %}" class="anchor-link"><i class="fa fa-user fa-1x marg-r"></i>{{data.user.username}}</a>
        {% else %}
        <a href="/login/" style: class="anchor-link-right" >Login</a>
        {% endif %}
      </div>
    </div>
    <div role="main" class="ui-content">
    <div id="border-left"></div>
    <div id="border-right"></div>

      <!-- Practitioner Details -->
      <div id="practitionerDetails">
        {% if not data.favourite %}
        <form action="{% url 'patient' %}" method="POST" class="inline_ favourite">{% csrf_token %}
          <input class="anchor-link-right" type="image" src="{% static "icons/favt_.png" %}" id="silver" height="32" width="32">
        </form>
        <img class="anchor-link-right" src="{% static "icons/favt0.png" %}" style="visibility: hidden;" id="golden" height="32" width="32" />
        {% else %}
        <img class="anchor-link-right" title="Already favourited" src="{% static "icons/favt0.png" %}" height="32" width="32" /> {% endif %}
        <h1><i class="fa fa-user-md fa-1x marg-r"></i>{{data.practitioner.name}}</h1>
        <span>{{data.practitioner.credentials}}</span>
        <span>Specialized in: {% for speciality in data.practitioner.specialities.all.iterator %}{{speciality.name}}</span>
        {% endfor %}
        <span>Experience: <strong>{{data.practitioner.experience}} years.</strong></span>
        <span><strong>Achievements: </strong>{{data.practitioner.achievements}}</span>
      </div>

      <!-- Practise-Location Details -->
      {% if data.practise.exists %}
      {% for pract in data.practise.iterator %}
      <div class="grid-name">
        {% if pract.practise_type == 'P' %}
        <h2 style="background-color: #4b555d;">{{pract.practitioner.name}}</h2>
        {% else %}
        <h2 style="background-color: #4b555d;">{{pract.practise_location.name}}</h2>
        {% endif %}
        <div class="clinic">
          <!-- Lad Clinic Timings -->
          <!-- Lad Clinic Timings -->
          <ul><div class="clock" id="/practise/{{pract.practise_location.slug}}/{{pract.practitioner.slug}}/">
          {% include "practitioner/clinictimings.html" %}
          <li><img src="{% static "icons/clock.png" %} "height="22" width="24" title="Clinic Timings." />
          <strong class="marg-l"><u>Practise Timing.</u></strong></li>
          </div>
          <!-- Load Clinic Timings -->
          <!-- Lad Clinic Timings -->
            <li><i class="fa fa-money" title="Checkup Fee."></i><span><strong>{{pract.checkup_fee}} rs.</strong></span></li>
            <li><i class="fa fa-phone"></i><span>{{pract.contact_number}}</span></li>
            <li><i class="fa fa-calendar"></i>{% if pract.appointments_only %}<span>Appointment Required: Yes.</span>
              {% else %}<span>First Come First Serve.</span>{% endif %}</li>
            <li><i class="fa fa-location-arrow"></i><span>{{pract.practise_location.clinic_address}}, <strong>{{pract.practise_location.city.name}}</strong></span></li>
            <li><i class="fa fa-medkit fa-1x" title="Services Offered."></i><span>{{pract.services}}</span></li>
          </ul>
          <div class="modified"><img src="{% static "icons/modified.png" %}"height="18" width="18" title="Last Updated"/><span class="marg-l">{{pract.modified|date:"d-M-Y"}}</span></div>
           {% if pract.practise_location.lat and pract.practise_location.lon %}
            <a href="http://maps.google.com/maps?z=12&t=m&q={{pract.practise_location.lat}},{{pract.practise_location.lon}}" target="_blank" class="anchor-link-right map-marker" ><i style="padding: 0px 0px 10px 0px;" class="fa fa-map-marker fa-3x"></i></a>
            {% endif %}
        </div>
      </div>
      {% endfor %}{% endif %}

      <!-- Practitioner Reviews Details -->
      <div class="grid-name">
        <h2 style="background-color: #4b555d;">Practise Reviews</h2>
        <div class="reviews">
          {% if data.reviews.exists %} {% for pr in data.reviews.iterator %}
          <!-- user login and reviews are there-->
          {% if data.user.is_authenticated %}
          <p>
            <span class="break"><b>{{pr.patient}}</b>: '{{pr.review_text}}'</span>
            <!-- review upVote-->
            <!-- review upVote-->
            <div class="inline_">
            <i class="fa fa-thumbs-o-up up" id="/review/{{pr.pk}}/"></i>
            <span class="up_votes marg-r">{{pr.up_votes}}</span>-
            <span class="down_votes marg-l">{{pr.down_votes}}</span>
            <i class="fa fa-thumbs-o-down marg-l down" id="/review/{{pr.pk}}/"></i>
            <span class="float-right marg-r"><i class="fa fa-clock-o marg-r" class="Reviewd Date."></i>{{pr.review_date|date:"d-M-Y"}}</span>
            </div>
          </p>
          <!-- review downVote-->
          <!-- review downVote-->

          <!-- No user login and reviews exists-->
          {% else %}
          <div>
            <span class="float-left break"><strong>{{pr.patient}}: </strong>'{{pr.review_text}}'</span>
            <span class="marg-r"><strong>agree: {{pr.up_votes}}</strong></span>
            <span class="marg-l"><strong>disagree: {{pr.down_votes}}</strong></span>
            <br>
            <span class="float-right marg-r"><i>{{pr.review_date|date:"d-M-Y"}}</i></span>
          </div>
          <br> {% endif %} {% endfor %} {% if data.user.is_authenticated %}
          
          <!-- Post new Reviews, user loged, Reviews exists-->
          <form id="reviewBox" action="{% url 'review' %}" method="POST" class="inline_">{% csrf_token %}
              <textarea cols="8" rows="8" name="review_text" required></textarea>
              <input type="hidden" name="slug" value="{{data.practitioner.slug}}">
              <button type="submit" id="post-review-btn" class="ui-btn ui-corner-all ui-btn-a">Post</button>
          </form>          
          {% else %}
          <p><a href="#loginSignup" class="anchor-link-right">add review</a>
          </p>
          {% endif %}
          <!--if no review-->
          {% elif data.user.is_authenticated%}
          <!-- user login and no review exists-->
          <strong><span class="textCentre">No reviews, yet, Write One.<span><br>
          <form id="reviewBox" action="{% url 'review' %}" method="POST" class="inline_">{% csrf_token %}
              <textarea cols="8" rows="8" name="review_text" required></textarea>
              <input type="hidden" name="slug" value="{{data.practitioner.slug}}">
              <button type="submit" id="post-review-btn" class="ui-btn ui-corner-all ui-btn-a">Post</button>
          </form>
          {% else %}
	<!-- Post new Review / no user login-->
	<span>No reviews, yet.<br><a href="#loginSignup" class="anchor-link-right">add review</a></span> {% endif %}
        </div>
      </div>
    </div>
    <!-- Footer Details -->
    <div class="foot" data-role="footer">
      <h4>
      <a href="https://www.facebook.com/doctorsinfo.pk" target="_blank"><i class="fa fa-facebook fa-1x"></i></a>
      <a href="mailto:doctorsinfo.pk@gmail.com"><i class="fa fa-envelope fa-1x"></i></a>
      <a href="http://twitter.com/doctorsinfo_pk" target="_blank"><i class="fa fa-twitter fa-1x"></i></a></h4>
    </div>

  </div>
  <!-- Login SignUp -->
  <div data-role="page" id="loginSignup" data-theme="a" data-title="doctorsinfo.pk">
    <div data-role="header">
      <h1><a href="/" class="anchor-link" ><i class="fa fa-stethoscope fa-1x marg-r"></i>doctorsinfo.pk</a></h1>
    </div>
    <div role="main" class="ui-content container">
      <div class="text-center">
        <span><a href="/login/" class="ui-btn ui-corner-all ui-shadow loginSignup">Login</a>
        <a href="/register/" class="ui-btn ui-corner-all ui-shadow loginSignup">Sign Up</a>
        <a href="/password/reset/" class="ui-btn ui-corner-all ui-shadow loginSignup">Forgot Password</a></span>
      </div>

      <!--footer-->
    <div class="foot" data-role="footer">
      <h4>
      <a href="https://www.facebook.com/doctorsinfo.pk" target="_blank"><i class="fa fa-facebook fa-1x"></i></a>
      <a href="mailto:doctorsinfo.pk@gmail.com"><i class="fa fa-envelope fa-1x"></i></a>
      <a href="http://twitter.com/doctorsinfo_pk" target="_blank"><i class="fa fa-twitter fa-1x"></i></a></h4>
    </div>
    </div>
  </div>

  <script type="text/javascript">
    var count = 0;
    /*  Load timings */
    $(function() {
     $('.clock').click(function(ev) {
        console.log('click')
        if (count < 1) {
        $.ajax({
            type: "GET",
            url: $(this).attr('id'),
            context: this,
            success: function(data) {
              $(this).prepend(data);
              count++;
            },
            dataType: 'html'
          });}else {
          ev.preventDefault();
        }
      });
    });
    /* favt	*/
    $(function() {
      var favtImg = $('.favourite');
      favtImg.click(function(ev) {
        var doc = "{{data.favourite}}";
        if (doc == "False")
        	$('golden').show();
          console.log('favt click');
        $.ajax({
          type: "POST",
          url: $(this).attr('action'),
          context: this,
          success: function(data) {
            if (data.status_) {
              $('silver').hide();
              $('golden').show();
            }
          },
          dataType: 'json',
        });
      });
    });
    /* up vote */
    $(function() {
      var up = $('.up');
      up.click(function(ev) {
        if (count < 2) {
          $.ajax({
            type: "POST",
            url: $(this).attr('id'),
            context: this,
            data: {
              up: "up",
              csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(data) {
              var up = $(this).next('.up_votes').text(data.up);
              down = up.next('.down_votes');
              up.text(data.up);
              down.text(data.down);
              count++;
            },
            dataType: 'json',
          });
        } else {
          ev.preventDefault();
        }
      });
    });
    /* down vote */
    $(function() {
      var down = $('.down');
      down.click(function(ev) {
        if (count < 2) {
          $.ajax({
            type: "POST",
            url: $(this).attr('id'),
            context: this,
            data: {
              down: "down",
              csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(data) {
              var down = $(this).prev('.down_votes');
              var up = down.prev('.up_votes');
              down.text(data.down);
              up.text(data.up);
              count++;
            },
            dataType: 'json'
          });
        } else {
          ev.preventDefault();
        }
      });
    });
  </script>
</body>

</html>