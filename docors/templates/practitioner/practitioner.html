<!DOCTYPE html> 
<html>
<head>
  {% load staticfiles %}
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="{% static "icons/stethoscope.ico" %}" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.css" />
  <script src="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.js"></script>
  <link rel="stylesheet" href="{% static "style/style.css" %}"rel="stylesheet" type="text/css" />
</head>
<body>
	<div data-role="page" data-title="{{data.practitioner.name}} | doctorsinfo.pk">
<div data-role="header">
	<h1><a href="/" class="anchor-link" >
	<img class="marg-r" src="{% static "icons/stethoscope.png" %}" height="18" width="18" />doctorsinfo.pk</a></h1>
      <div id="head">
      {% if data.user.is_authenticated %}
      <a href="{% url 'patient' %}" style: id="user" >
        <img class="marg-r" src="{% static "icons/person.jpg" %}" height="22" width="22" />{{data.user.username}}</a>
      {% else %}
        <a href="/login/" style: class="anchor-link-right" >Login</a>
      {% endif %}
      </div>
</div>
	<div role="main" class="ui-content container">

	<!-- Practitioner Details -->
	<div id="practitionerDetails">
		{% if not data.favourite %}
		<form action="{% url 'patient' %}" method="POST" class="inline_">{% csrf_token %}
			<input class="anchor-link-right" type="image" src="{% static "icons/favt_.png" %}" height="32" width="32">
			<input type="hidden" name="slug" value="{{data.practitioner.slug}}">
			<input type="hidden" name="favt" value="{{data.favourite}}">
		</form>
		{% else %}
		<img class="anchor-link-right" title="Already favourited" src="{% static "icons/favt0.png" %}" height="32" width="32" />
		{% endif %}
		<h1>{{data.practitioner.name}}</h1>
		<span>{{data.practitioner.credentials}}</span><br>
		<span>Specialized in: {% for speciality in data.practitioner.specialities.all.iterator %}
		{{speciality.name}}</span><br>
		{% endfor %}
		<span>Experience: <strong>{{data.practitioner.experience}} years.</strong></span><br><br>
		<span><strong>Achievements: </strong>{{data.practitioner.achievements}}</span><br><br>
	</div>	

	<div class="ui-grid-b">
		<!-- Practise-Location Details -->
		{% if data.practise.exists %}
		{% for pract in data.practise.iterator %}
		<div class="ui-block-a clinicDetails">
		<div class="ui-bar ui-bar-a lightgreen-bg" >
		<ul class="normalweight">
		<li><center><h2>Clinic Details.</h2></center></li>
		<li><center><h3>{{pract.practise_location.name}}</h3></center></li><br>
		<li><span class="marg-r">fee:</span><span><strong>{{pract.checkup_fee}} rs.</strong></span></li><br>
		<li><img src="{% static "icons/phone.png" %}" class="icon" height="20" width="20" /></li>
		<span>{{pract.contact_number}}</span><br>
		<li><img src="{% static "icons/app.png" %}" class="icon" title="Appointment Required ?" height="20" width="20" /></li>
		{% if pract.appointments_only %}
		<span class="small-font">Appointment Only: Yes.</span><br>
		{% else %}
		<span>First Come First Serve.</span><br>
		{% endif %}
		<li><img src="{% static "icons/address_.png" %}" class="icon" height="22" width="18" /></li>
		<span>{{pract.practise_location.clinic_address}}, <strong>{{pract.practise_location.city.name}}</strong></span><br>
		<li><img src="{% static "icons/stethoscope.png" %}" class="icon" title="Services Offered." height="20" width="20" /></li>
		<span>{{pract.services}}</span><br><br>
		{% if pract.practise_location.lat and pract.practise_location.lon %}
		<li class="float-right">
			<a href="http://maps.google.com/maps?z=12&t=m&q={{pract.practise_location.lat}},{{pract.practise_location.lon}}" target="_blank" class="anchor-link">
			<img src="{% static "icons/map1.png" %}" title="Services Offered." class="icon" height="24" width="24" /></a>
		</li>{% endif %}</ul>
		</div></div>
		{% endfor %}
		{% endif %}

	<!-- Clinic Timings Details -->
	
	{% if data.practise_timing %}
	<div class="ui-block-b clinicTimingsDetails">
		<div class="ui-bar ui-bar-a ctbg normalweight textCentre">
		<ul class="normalweight">
		<li><center><h2>Clinic Timings.</h2></center></li>
		{% for oneClinic in data.practise_timing %}
			<li><center><h3>{{ oneClinic.name }}</h3></center></li><br>
			<span class="marg-r"><strong>Day</strong></span>
			<span class="marg-r"><strong>Opens</strong></span>
			<span class="marg-r"><strong>Closes</strong></span><br>
			{% for clinicTime in oneClinic.timing %}
			<span class="marg-r">{{clinicTime.day}}</span>
			<span class="marg-r">{{clinicTime.start_time}}</span>
			<span class="marg-r">{{clinicTime.end_time}}</span><br>
			{% endfor %}
			<br>
		{% endfor %}
		</ul>
		</div>
	</div>
	{% endif %}

	<!-- Practitioner Reviews Details -->
	<div class="ui-block-c practitionerReviews">
	<div class="ui-bar ui-bar-a">
	{% if data.reviews.exists %}
	<center><h2>Practitioner Reviews.</h2></center><br>
	{% for pr in data.reviews.iterator %}
	
	<!-- user login and reviews are there-->
	{% if data.user.is_authenticated %}
	<p class="normalweight">
	<span><b>{{pr.patient}}</b> says: '{{pr.review_text}}'</span>s<br>
	<span class="float-right"><i>{{pr.review_date}}</i></span><br>
	
	<!-- review upVote-->
	<center><div id="votes" class="inline_">
	<form action="{% url 'review' pr.pk %}" class="inline_ up" >
		<input class="marg-r" type="image" src="{% static "icons/up.png" %}" height="14" width="14" />
	</form>
	<!-- review downVote-->
	<span class="up_votes marg-r">{{pr.up_votes}}</span>-
	<span class="down_votes marg-l">{{pr.down_votes}}</span>
	<form action="{% url 'review' pr.pk %}" class="inline_ down">
		<input class="marg-l" type="image" src="{% static "icons/down.png" %}" height="14" width="14" />
	</form><br></div></center></p>
	
	<!-- No user login and reviews exists-->
	{% else %}
	<div class="normalweight textCentre">
	<span class="float-left"><strong>{{pr.patient}}: </strong>'{{pr.review_text}}'</span><br>
	<span class="marg-r"><strong>agree: {{pr.up_votes}}</strong></span>
	<span class="marg-l"><strong>disagree: {{pr.down_votes}}</strong></span><br>
	<span class="float-right"><i>{{pr.review_date}}</i></span></div><br>
	{% endif %}
	{% endfor %}

	{% if data.user.is_authenticated %}
	<!-- Post new Reviews, user loged, Reviews exists-->

	<div id="reviewBox" data-role="collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-iconpos="right"><h6>add review</h6>
	<form action="{% url 'review' %}" method="POST" class="inline_">{% csrf_token %}
	{% if data.practise_name.count > 1 %}
  	<select name="practise_slug" required id="select-native-2">
  	<option value="">Select Practise Location.</option>
  	{% for locname in data.practise_name.iterator %}
  	<option value="{{locname.practise_location.slug}}">{{locname.practise_location.name}}</option>
  	{% endfor %}
  	<textarea cols="8" rows="8" name="review_text" required></textarea></select>
  	{% endif %}
	<input type="hidden" name="slug" value="{{data.practitioner.slug}}" >
	<button type="submit" id="post-review-btn" class="ui-btn ui-corner-all ui-btn-a">Post</button></form></div>
	{% else %}
	<p><a href="#loginSignup" class="anchor-link-right">add review</a></p>
	{% endif %}
	<!--if no review-->
	{% elif data.user.is_authenticated%}
	<!-- user login and no review exists-->
	<span>No reviews, yet.<span><br>
	<div id="reviewBox" data-role="collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-iconpos="right"><h6>add review</h6>
	<form action="{% url 'review' %}" method="POST" class="inline_">{% csrf_token %}
	{% if data.practise_name.count > 1 %}
  	<select name="practise_slug" required id="select-native-2">
  	<option value="">Select Practise Location.</option>
  	{% for locname in data.practise_name.iterator %}
  	<option value="{{locname.practise_location.slug}}">{{locname.practise_location.name}}</option>
  	{% endfor %}
  	<textarea cols="8" rows="8" name="review_text" required></textarea>
  	</select>
  	{% endif %}
	<input type="hidden" name="slug" value="{{data.practitioner.slug}}" >
	<button type="submit" id="post-review-btn" class="ui-btn ui-corner-all ui-btn-a">Post</button></form></div>
	{% else %}
	<!-- Post new Review / no user login-->
	<span>No reviews, yet.<br><a href="#loginSignup" class="anchor-link-right">add review</a></span>
	{% endif %}
	</div>
	</div>
	</div>
	</div>
	<!-- Footer Details -->
	<div data-role="footer">
	<h4>&copy; all rights reserved-2014 &reg;</h4>
	</div>
	</div>
<!-- Login SignUp -->
<div data-role="page" id="loginSignup" data-theme="a" data-title="doctorsinfo.pk">
<div data-role="header">
<h1><a href="/" class="anchor-link" >
  <img class="marg-r" src="{% static "icons/stethoscope.png" %}" height="18" width="18" />doctorsinfo.pk</a></h1>
</div>
<div role="main" class="ui-content container" >
<center><a href="/login/" class="ui-btn ui-corner-all ui-shadow loginSignup">Login</a></center>
<center><a href="/register/" class="ui-btn ui-corner-all ui-shadow loginSignup">Sign Up</a></center>
<center><a href="/password/reset/" class="ui-btn ui-corner-all ui-shadow loginSignup">Forgot Password</a></center>

<!--footer-->
<div style="margin: auto auto;" data-role="footer">
<h4>&copy; all rights reserved-2014 &reg;</h4>
</div>
</div>

</div>
<script type="text/javascript">
	var count = 0;
	/* favt	*/
	$(function () {
		var favtImg = $('#favt');
		favtImg.submit(function (ev) {
			console.log('favt');
			$.ajax({type:"POST", url: $(this).attr('action'), data: { favt: "favourite",
		},
		success: function(data) {
			var up = $(this).next('.up_votes').text(data.up);
			down = up.next('.down_votes');
			up.text(data.up);
			down.text(data.down);
			count ++;
		},
		dataType : 'json',
	});
			ev.preventDefault();
		});
	});
	/* up vote */
	$(function () {
		var up = $('.up');
		up.submit(function (ev) {
			if (count < 2){
				$.ajax({type:"POST", url: $(this).attr('action'),context: this, data: { up: "up", csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function(data) {
				var up = $(this).next('.up_votes').text(data.up);
				down = up.next('.down_votes');
				up.text(data.up);
				down.text(data.down);
				count ++;
			},
			dataType : 'json',
		});
				ev.preventDefault();
			}
			else{ 
				ev.preventDefault();
			}
		});
	});
	/* down vote */
	$(function () {
		var down = $('.down');
		down.submit(function (ev) {
			if (count<2){
				console.log(count);
				$.ajax({type:"POST", url: $(this).attr('action'),context: this, data: { down: "down", csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function(data) {
				var down = $(this).prev('.down_votes');
				var up = down.prev('.up_votes');
				down.text(data.down);
				up.text(data.up);
				count ++;
			},
			dataType : 'json'
		});
				ev.preventDefault();
			}
			else{
				ev.preventDefault();
			}
		});
	});
</script>
</body>
</html>
