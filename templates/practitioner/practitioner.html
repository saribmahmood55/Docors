<!DOCTYPE html> 
<html>
<head>
	{% load static from staticfiles %}
	<link rel="shortcut icon" href="{% static "icons/stethoscope.ico" %}">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="{% static "jquery_mobile/jquery.mobile-1.4.4.min.css" %}" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="{% static "jquery_mobile/style.css" %}"rel="stylesheet" type="text/css" >
	<script src="{% static "jquery_mobile/jquery-1.9.1.min.js" %}" type="text/javascript"></script>
	<script src="{% static "jquery_mobile/jquery.mobile-1.4.4.min.js" %}" type="text/javascript"></script>
	<script src="{% static "jquery_mobile/jquery.mobile-1.4.4.min.map" %}" type="text/javascript"></script>
</head>
<body>
	<div data-role="page" data-title="{{data.practitioner.name}} | doctorsinfo.pk">
<div data-role="header">
	<h1 class="ui-icon-myicon">
        <a href="http://localhost:8000/" class="anchor-link" >doctorsinfo.pk&nbsp;&nbsp;
        <img src="{% static "icons/stethoscope.png" %}" height="18" width="18" /></a>
    </h1>
      <div id="head">
      {% if data.user.is_authenticated %}
        <a href="{% url 'patient' %}" style: id="user" >{{data.user.username}}</a>
      {% else %}
        <a href="/login/" style: class="anchor-link-right" >Login</a>
      {% endif %}
      </div>
</div>
	<div role="main" class="ui-content">

	<!-- Practitioner Details -->
	<div id="practitionerDetails">
		{% if not data.favorite %}
		<form action="{% url 'patient' %}" method="POST" class="inline_">{% csrf_token %}
			<input class="anchor-link-right" type="image" src="{% static "icons/favt_.png" %}" height="32" width="32">
			<input type="hidden" name="slug" value="{{data.practitioner.slug}}">
			<input type="hidden" name="favt" value="{{data.favorite}}">
		</form>
		{% else %}
		<img class="anchor-link-right" title="Already favourited" src="{% static "icons/favt0.png" %}" height="32" width="32" />
		{% endif %}
		<h1>{{data.practitioner.name}}</h1>
		<span>{{data.practitioner.credentials}}</span><br>
		<span>Specialized in: {% for speciality in data.practitioner.specialities.all.iterator %}
		{{speciality.name}}</span><br>
		{% endfor %}
		<span>Experience: <strong>{{data.practitioner.experience}} years.</strong></span><br>
		<span>Achievements: {{data.practitioner.achievements}}</span><br><br>
	</div>	

		<div class="ui-grid-b">
		<!-- Practise-Location Details -->
		{% if data.practise.exists %}
		{% for pract in data.practise.iterator %}
		<div class="ui-block-a clinicDetails">
		<div class="ui-bar ui-bar-a" >
		<ul class="normalweight">
		<span><center><h3>Clinic Details.</h3></center></span>
		<span><center>{{pract.practise_location.name}}</center></span><br>
		<span>Fee:&nbsp;&nbsp;<strong>{{pract.checkup_fee}} rs.</strong></span><br>
		<li><img src="{% static "icons/phone.png" %}" class="icon" height="20" width="20" /></li>
		<span>{{pract.contact_number}}</span><br>
		<li><img src="{% static "icons/app.png" %}" class="icon" title="Appointment Required ?" height="20" width="20" /></li>
		{% if pract.appointments_only %}<span>Yes.</span><br>{% else %}<span>First Come First Serve.</span><br>{% endif %}
		<li><img src="{% static "icons/address_.png" %}" class="icon" height="22" width="18" /></li>
		<span>{{pract.practise_location.clinic_address}}, <strong>{{pract.practise_location.city.name}}</strong></span><br>
		<li><img src="{% static "icons/stethoscope.png" %}" class="icon" title="Services Offered." height="20" width="20" /></li>
		<span>{{pract.services}}</span><br><br>
		{% if pract.practise_location.lat and pract.practise_location.lon %}
		<li class="float-right">
			<a href="http://maps.google.com/maps?z=12&t=m&q={{pract.practise_location.lat}},{{pract.practise_location.lon}}" target="_blank" class="anchor-link">
			<img src="{% static "icons/map1.png" %}" title="Services Offered." class="icon" height="24" width="24" /></a>
		</li>{% endif %}</ul>
		</div></div>
		{% endfor %}
		{% endif %}

	<!-- Clinic Timings Details -->
	
	{% if data.practise_timing %}
	<div class="ui-block-b clinicTimingsDetails">
		<div class="ui-bar ui-bar-a normalweight textCentre">
		<center><h3>Clinic Timings.</h3></center>
		{% for oneClinic in data.practise_timing %}
			<span><strong>{{oneClinic.name}}</strong></span><br><br>
			<span style="padding-right: 10px;"><strong>Day</strong></span>
			<span style="padding-right: 10px;"><strong>Opens</strong></span>
			<span style="padding-right: 10px;"><strong>Closes</strong></span><br>
			{% for clinicTime in oneClinic.timing %}
			<span style="padding-right: 5px;">{{clinicTime.day}}</span>
			<span style="padding-right: 5px;">{{clinicTime.start_time}}</span>
			<span style="padding-right: 5px;">{{clinicTime.end_time}}</span><br>
			{% endfor %}
			<br>
		{% endfor %}	
		</div>
	</div>
	{% endif %}

	<!-- Practitioner Reviews Details -->
	{% if data.reviews.exists %}
	<div class="ui-block-c practitionerReviews">
		<div class="ui-bar ui-bar-a">
			<center><h3>Practitioner Reviews.</h3></center>
	{% for pr in data.reviews.iterator %}
	{% if data.user.is_authenticated %}
	<p class="normalweight">
	<b>{{pr.patient}}</b> say: '{{pr.review_text}}'<br>Submitted on: <i>{{pr.review_date}}</i>
	
	<!-- review upVote-->
	<center><div id="votes" class="inline_">
	<form action="{% url 'review' pr.pk %}" class="inline_ up" >
		<input style="margin-right: 10px;" type="image" src="{% static "icons/up.png" %}" height="14" width="14" />
	</form>
	<!-- review upVote-->
	<span style="margin-right: 15px;" class="up_votes">{{pr.up_votes}}</span>-
	<span style="margin-left: 10px;" class="down_votes">{{pr.down_votes}}</span>
	<form action="{% url 'review' pr.pk %}" class="inline_ down">
		<input style="margin-left: 10px;" type="image" src="{% static "icons/down.png" %}" height="14" width="14" />
	</form><br></div></center></p>
	{% else %}
	<center><p class="normalweight"><b>{{pr.patient}}: </b>'{{pr.review_text}}'<br>
	agree: {{pr.up_votes}}&nbsp;&nbsp;-&nbsp;&nbsp;disagree: {{pr.down_votes}}<br>
	Submitted on: <i>{{pr.review_date}}</i></p></center>
	{% endif %}
	{% endfor %}
	<!-- Post new Reviews-->
	{% if data.user.is_authenticated %}
	<div id="reviewBox" data-role="collapsible" data-collapsed="true" data-collapsed-icon="carat-d" data-expanded-icon="carat-u" data-iconpos="right"><h6>add review</h6>
	
	<!-- New Review Form-->
	<form action="{% url 'review' %}" method="POST" class="inline_">{% csrf_token %}
	{% if data.practise_name.count > 1 %}
  	<select name="practise_slug" required id="select-native-2">
  	<option value="">Select Practise Location.</option>
  	{% for locname in data.practise_name.iterator %}
  	<option value="{{locname.practise_location.slug}}">{{locname.practise_location.name}}</option>
  	{% endfor %}
  	<textarea cols="8" rows="8" name="review_text" required></textarea>
  	</select>
  	{% endif %}
	<input type="hidden" name="slug" value="{{data.practitioner.slug}}" >
	<button type="submit" id="post-review-btn" class="ui-btn ui-corner-all ui-btn-a">Post</button>
	</form>
	</div>
	{% else %}
	<!-- no user login	-->
	<p><a href="#loginSignup" class="anchor-link-right">add review</a></p>
	{% endif %}
	{% else %}
	<p>No reviews, yet.<br></p>
	{% endif %}
	</div>
	</div>
	</div>
	</div>
	<!-- Footer Details -->
	<div data-role="footer">
	<h4>&copy; all rights reserved-2014 &reg;</h4>
	</div>
	</div>
<!-- Login SignUp -->
<div data-role="page" id="loginSignup" data-theme="a" data-title="doctorsinfo.pk">
<div data-role="header">
	<h1>
        <a href="http://localhost:8000/" class="anchor-link" >doctorsinfo.pk&nbsp;&nbsp;
        <img src="{% static "icons/stethoscope.png" %}" height="18" width="18" /></a>
    </h1>
</div>
<div role="main" class="ui-content container" >
<center><a href="/login/" class="ui-btn ui-corner-all ui-shadow loginSignup">Login</a></center>
<center><a href="/register/" class="ui-btn ui-corner-all ui-shadow loginSignup">Sign Up</a></center>
<center><a href="/password/reset/" class="ui-btn ui-corner-all ui-shadow loginSignup">Forgot Password</a></center>
<!--footer-->
<div style="margin: auto auto;" data-role="footer">
<h4>&copy; all rights reserved-2014 &reg;</h4>
</div>
</div>

</div>
<script type="text/javascript">
	var count = 0;
	/* favt	*/
	$(function () {
		var favtImg = $('#favt');
		favtImg.submit(function (ev) {
			console.log('favt');
			$.ajax({type:"POST", url: $(this).attr('action'), data: { favt: "favourite",
		},
		success: function(data) {
			var up = $(this).next('.up_votes').text(data.up);
			down = up.next('.down_votes');
			up.text(data.up);
			down.text(data.down);
			count ++;
		},
		dataType : 'json',
	});
			ev.preventDefault();
		});
	});
	/* up vote */
	$(function () {
		var up = $('.up');
		up.submit(function (ev) {
			if (count < 2){
				$.ajax({type:"POST", url: $(this).attr('action'),context: this, data: { up: "up", csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function(data) {
				var up = $(this).next('.up_votes').text(data.up);
				down = up.next('.down_votes');
				up.text(data.up);
				down.text(data.down);
				count ++;
			},
			dataType : 'json',
		});
				ev.preventDefault();
			}
			else{ 
				ev.preventDefault();
			}
		});
	});
	/* down vote */
	$(function () {
		var down = $('.down');
		down.submit(function (ev) {
			if (count<2){
				console.log(count);
				$.ajax({type:"POST", url: $(this).attr('action'),context: this, data: { down: "down", csrfmiddlewaretoken: '{{ csrf_token }}'
			},
			success: function(data) {
				var down = $(this).prev('.down_votes');
				var up = down.prev('.up_votes');
				down.text(data.down);
				up.text(data.up);
				count ++;
			},
			dataType : 'json'
		});
				ev.preventDefault();
			}
			else{
				ev.preventDefault();
			}
		});
	});
</script>
</body>
</html>
